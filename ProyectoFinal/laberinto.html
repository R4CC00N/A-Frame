<!DOCTYPE html>
<html>
<head>
  <title>Laberinto Aleatorio en A-Frame</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
  <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>
</head>
<body>
  <a-scene xr-mode-ui="enabled: false">
    <a-assets>
      <img id="NormalMap" src="img/Rock_normal.jpg" alt="normalMap">
      <img id="texture" src="img/Rock_albedo.jpg" alt="texture">
      <img id="ao" src="img/Rock_ao.jpg" alt="ap">
    </a-assets>

      <!--Cursor-->
      <a-entity movement-controls="fly: false" position="0 0 -1">
        <a-entity camera position="30 1.6 25" look-controls wasd-controls></a-entity>
        <a-entity cursor="rayOrigin:mouse"></a-entity>
      </a-entity>
      
    <!-- Lights -->
    <a-light type="ambient" color="#333"></a-light>
    <a-light type="directional" intensity="0.5" position="-1 1 0"></a-light>

    <!-- Script to generate a random maze -->
    <script>
      AFRAME.registerComponent('random-maze', {
        init: function () {
          var sceneEl = this.el;
          var mazeWidth = 50;
          var mazeHeight = 50;

          // Generate random maze
          for (var x = 0; x < mazeWidth; x++) {
            for (var z = 0; z < mazeHeight; z++) {
              if (Math.random() < 0.3) {
                var wall = document.createElement('a-box');
                wall.setAttribute('color', '#ffffff');
                wall.setAttribute('width', '1');
                wall.setAttribute('height', '3');
                wall.setAttribute('depth', '1');
                wall.setAttribute('static-body', ''); // Add static collision
                wall.setAttribute('position', { x: x - mazeWidth / 2, y: 1, z: z - mazeHeight / 2 });
                // Materials
                wall.setAttribute('src', '#texture');
                wall.setAttribute('repeat', '1 1');
                wall.setAttribute('normal-map', '#NormalMap');
                wall.setAttribute('normal-texture-repeat', '1 -1');
                wall.setAttribute('normal-scale', '1 -1');
                wall.setAttribute('roughness', '0.2');
                wall.setAttribute('ambient-occlusion-map', '#ao');
                wall.setAttribute('ambient-occlusion-texture-repeat', '1 1');

                sceneEl.appendChild(wall);
              }
            }
          }

          // Mark center of maze
          var centerMarker = document.createElement('a-cylinder');
          centerMarker.setAttribute('radius', '0.5');
          centerMarker.setAttribute('height', '80');
          centerMarker.setAttribute('color', 'cyan');
          centerMarker.setAttribute('position', { x: 0, y: 0, z: 0 }); // Center coordinates
          centerMarker.setAttribute('opacity', '0.5');
          sceneEl.appendChild(centerMarker);
        }
      });
    </script>

    <a-entity environment="preset: japan; groundColor: #445; grid: cross"></a-entity>
    <!-- Object container for the script -->
    <a-entity random-maze></a-entity>
  </a-scene>
</body>
</html>
